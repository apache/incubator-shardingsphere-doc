<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="Cache-Control" content="max-age=7200" />
    <meta name="generator" content="Hugo 0.37.1" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="https://shardingsphere.apache.org/document/current/img/favicon.png" type="image/x-icon" />

    <title>Test Engine :: ShardingSphere</title>
    
    
    <link href="https://shardingsphere.apache.org/community/css/nucleus.css?1572453612" rel="stylesheet">
    <link href="https://shardingsphere.apache.org/community/css/font-awesome.min.css?1572453612" rel="stylesheet">
    <link href="https://shardingsphere.apache.org/community/css/hybrid.css?1572453612" rel="stylesheet">
    <link href="https://shardingsphere.apache.org/community/css/featherlight.min.css?1572453612" rel="stylesheet">
    <link href="https://shardingsphere.apache.org/community/css/perfect-scrollbar.min.css?1572453612" rel="stylesheet">
    <link href="https://shardingsphere.apache.org/community/css/auto-complete.css?1572453612" rel="stylesheet">
    <link href="https://shardingsphere.apache.org/community/css/theme.css?1572453612" rel="stylesheet">
    <link href="https://shardingsphere.apache.org/community/css/hugo-theme.css?1572453612" rel="stylesheet">
    
      <link href="https://shardingsphere.apache.org/community/css/theme-black.css?1572453612" rel="stylesheet">
    

    <script src="https://shardingsphere.apache.org/community/js/jquery-2.x.min.js?1572453612"></script>
    
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{ 
          display:none !important;
      }
      
    </style>
    

  </head>
  <body class="" data-url="/en/contribute/test-engine/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <img src="https://shardingsphere.apache.org/document/current/img/logo_v2.png" />

    </div>
    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/en/contribute/" title="Get Involved" class="dd-item 
        parent
        
        
        ">
      <a href="https://shardingsphere.apache.org/community/en/contribute/">
          <b>1. </b>Get Involved
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/en/contribute/subscribe/" title="Subscribe Guide" class="dd-item ">
        <a href="https://shardingsphere.apache.org/community/en/contribute/subscribe/">
        Subscribe Guide
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/contribute/contributor/" title="Contributor Guide" class="dd-item ">
        <a href="https://shardingsphere.apache.org/community/en/contribute/contributor/">
        Contributor Guide
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/contribute/committer/" title="Committer Guide" class="dd-item ">
        <a href="https://shardingsphere.apache.org/community/en/contribute/committer/">
        Committer Guide
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/contribute/release/" title="Release Guide" class="dd-item ">
        <a href="https://shardingsphere.apache.org/community/en/contribute/release/">
        Release Guide
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/contribute/document-contributor/" title="Documents Contributor Guide" class="dd-item ">
        <a href="https://shardingsphere.apache.org/community/en/contribute/document-contributor/">
        Documents Contributor Guide
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/contribute/2fa/" title="2FA" class="dd-item ">
        <a href="https://shardingsphere.apache.org/community/en/contribute/2fa/">
        2FA
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/contribute/code-conduct/" title="Code of Conduct" class="dd-item ">
        <a href="https://shardingsphere.apache.org/community/en/contribute/code-conduct/">
        Code of Conduct
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/contribute/external-dependency/" title="External dependencies" class="dd-item ">
        <a href="https://shardingsphere.apache.org/community/en/contribute/external-dependency/">
        External dependencies
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/en/contribute/test-engine/" title="Test Engine" class="dd-item active">
        <a href="https://shardingsphere.apache.org/community/en/contribute/test-engine/">
        Test Engine
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/company/" title="Powered By ShardingSphere" class="dd-item 
        
        
        
        ">
      <a href="https://shardingsphere.apache.org/community/en/company/">
          <b>2. </b>Powered By ShardingSphere
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/team/" title="Team" class="dd-item 
        
        
        
        ">
      <a href="https://shardingsphere.apache.org/community/en/team/">
          <b>3. </b>Team
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/security/" title="security" class="dd-item 
        
        
        
        ">
      <a href="https://shardingsphere.apache.org/community/en/security/">
          <b>4. </b>security
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fa fa-fw fa-language"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
<option id="en" value="/community/en/contribute/test-engine/" selected>English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
<option id="cn" value="/community/cn/contribute/test-engine/">Chinese</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
       
      
      
      </ul>
    </section>
    
    <section id="footer">
      <p></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fa fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            <a href='https://shardingsphere.apache.org/community/en/'>ShardingSphere</a> > <a href='https://shardingsphere.apache.org/community/en/contribute/'>Get Involved</a> > Test Engine
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li><a href="#integration-test">Integration Test</a>
<ul>
<li><a href="#configuration">Configuration</a>
<ul>
<li><a href="#environment-configuration">Environment Configuration</a></li>
<li><a href="#sql-configuration">SQL Configuration</a></li>
<li><a href="#assert-configuration">Assert Configuration</a></li>
</ul></li>
<li><a href="#notice">Notice</a></li>
</ul></li>
<li><a href="#sql-parsing-engine-test">SQL Parsing Engine Test</a>
<ul>
<li><a href="#prepare-data">Prepare Data</a>
<ul>
<li><a href="#sql-data">SQL Data</a></li>
<li><a href="#parser-assert-data">Parser Assert Data</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Test Engine</h1>
          

        




<p>ShardingSphere provided a full functionality test engine. it defines SQLs in xml files, every single SQL is drove by SQL parse unit test engine and integration test engine,
each engine is suit for H2、MySQL、PostgreSQL、SQLServer and Oracle</p>

<p>The SQL parsing unit test covers both SQL placeholder and literal dimension.
Integration test can be further divided into two dimensions of strategy and JDBC; the former one includes strategies as Sharding, table Sharding, database Sharding, and read-write split while the latter one includes <code>Statement</code> and <code>PreparedStatement</code>.</p>

<p>Therefore, one SQL can drive 5 kinds of database parsing * 2 kinds of parameter transmission modes + 5 kinds of databases * 5 kinds of Sharding strategies * 2 kinds of JDBC operation modes = 60 test cases, to enable ShardingSphere to achieve the pursuit of high quality.</p>

<h1 id="integration-test">Integration Test</h1>

<h2 id="configuration">Configuration</h2>

<p>in order to make test easier to start, integration-test is designed to modify the following configuration files to execute all asserts without any Java code modification
  - environment type
    - /incubator-shardingsphere/sharding-integration-test/sharding-jdbc-test/src/test/resources/integrate/env.properties
    - /incubator-shardingsphere/sharding-integration-test/sharding-jdbc-test/src/test/resources/integrate/env/SQL-TYPE/dataset.xml
    - /incubator-shardingsphere/sharding-integration-test/sharding-jdbc-test/src/test/resources/integrate/env/SQL-TYPE/schema.xml
  - test case type
    - /incubator-shardingsphere/sharding-integration-test/sharding-jdbc-test/src/test/resources/integrate/cases/SQL-TYPE/SQL-TYPE-integrate-test-cases.xml
    - /incubator-shardingsphere/sharding-integration-test/sharding-jdbc-test/src/test/resources/integrate/cases/SQL-TYPE/dataset/SHARDING-TYPE/<em>.xml
  - sql-case
    - /incubator-shardingsphere/sharding-sql-test/src/main/resources/sql/sharding/SQL-TYPE/</em>.xml</p>

<h3 id="environment-configuration">Environment Configuration</h3>

<p>Integration test depends on existed database environment, we need to modify the config file for corresponding database to test</p>

<p>first, modify config file <code>/incubator-shardingsphere/sharding-integration-test/sharding-jdbc-test/src/test/resources/integrate/env.properties</code> ，for example ：</p>

<pre><code class="language-env"># the switch for PK, concurrent, column index testing and so on
run.additional.cases=false

# sharding rule, could define multiple rules
sharding.rule.type=db,tbl,dbtbl_with_masterslave,masterslave

# databse type, could define multiple databses(H2,MySQL,Oracle,SQLServer,PostgreSQL)
databases=MySQL,PostgreSQL

# mysql config
mysql.host=127.0.0.1
mysql.port=13306
mysql.username=root
mysql.password=root

## postgresql config
postgresql.host=db.psql
postgresql.port=5432
postgresql.username=postgres
postgresql.password=

## sqlserver config
sqlserver.host=db.mssql
sqlserver.port=1433
sqlserver.username=sa
sqlserver.password=Jdbc1234

## oracle config
oracle.host=db.oracle
oracle.port=1521
oracle.username=jdbc
oracle.password=jdbc
</code></pre>

<p>after that we need to modify config file <code>/incubator-shardingsphere/sharding-integration-test/sharding-jdbc-test/src/test/resources/integrate/env/SQL-TYPE/dataset.xml</code> 。
in dataset.xml, set up metadata(sharding rule) and row(test data) to start the data initialization. for example, define table sharding rule and test data as following:</p>

<pre><code class="language-xml">&lt;dataset&gt;
    &lt;metadata data-nodes=&quot;tbl.t_order_${0..9}&quot;&gt;
        &lt;column name=&quot;order_id&quot; type=&quot;numeric&quot; /&gt;
        &lt;column name=&quot;user_id&quot; type=&quot;numeric&quot; /&gt;
        &lt;column name=&quot;status&quot; type=&quot;varchar&quot; /&gt;
    &lt;/metadata&gt;
    &lt;row data-node=&quot;tbl.t_order_0&quot; values=&quot;1000, 10, init&quot; /&gt;
    &lt;row data-node=&quot;tbl.t_order_1&quot; values=&quot;1001, 10, init&quot; /&gt;
    &lt;row data-node=&quot;tbl.t_order_2&quot; values=&quot;1002, 10, init&quot; /&gt;
    &lt;row data-node=&quot;tbl.t_order_3&quot; values=&quot;1003, 10, init&quot; /&gt;
    &lt;row data-node=&quot;tbl.t_order_4&quot; values=&quot;1004, 10, init&quot; /&gt;
    &lt;row data-node=&quot;tbl.t_order_5&quot; values=&quot;1005, 10, init&quot; /&gt;
    &lt;row data-node=&quot;tbl.t_order_6&quot; values=&quot;1006, 10, init&quot; /&gt;
    &lt;row data-node=&quot;tbl.t_order_7&quot; values=&quot;1007, 10, init&quot; /&gt;
    &lt;row data-node=&quot;tbl.t_order_8&quot; values=&quot;1008, 10, init&quot; /&gt;
    &lt;row data-node=&quot;tbl.t_order_9&quot; values=&quot;1009, 10, init&quot; /&gt;
&lt;/dataset&gt;
</code></pre>

<p>you could add more &ldquo;create table&rdquo; / &ldquo;create schema&rdquo; clause if you want some other test data</p>

<h3 id="sql-configuration">SQL Configuration</h3>

<p>so far we already set up the environment config and the initialization data, we need to add the SQL we want to test, in another word, we set up the SQL for assert base on that environment
the sql for assert in define in <code>/incubator-shardingsphere/sharding-sql-test/src/main/resources/sql/sharding/SQL-TYPE/*.xml</code>，like following configuration :</p>

<pre><code class="language-xml">&lt;sql-cases&gt;
    &lt;sql-case id=&quot;update_without_parameters&quot; value=&quot;UPDATE t_order SET status = 'update' WHERE order_id = 1000 AND user_id = 10&quot; /&gt;
    &lt;sql-case id=&quot;update_with_alias&quot; value=&quot;UPDATE t_order AS o SET o.status = ? WHERE o.order_id = ? AND o.user_id = ?&quot; db-types=&quot;MySQL,H2&quot; /&gt;
  &lt;/sql-cases&gt;
</code></pre>

<p>base on that config, we set up the sql for assert and database type. and these sqls could share in different module, that&rsquo;s why we extract the sharding-sql-test as a stand alone module</p>

<h3 id="assert-configuration">Assert Configuration</h3>

<p>we have confirmed what kind of sql execute in which environment in upon config, hereby let&rsquo;s define the data for assert
there are two kinds of config for assert, one is at <code>/incubator-shardingsphere/sharding-integration-test/sharding-jdbc-test/src/test/resources/integrate/cases/SQL-TYPE/SQL-TYPE-integrate-test-cases.xml</code>
this file just like an index, defined the sql, parameters and expected index position for execution . the sql is the value for sql-case-id, example as following :</p>

<pre><code class="language-xml">&lt;integrate-test-cases&gt;
    &lt;dml-test-case sql-case-id=&quot;insert_with_all_placeholders&quot;&gt;
       &lt;assertion parameters=&quot;1:int, 1:int, insert:String&quot; expected-data-file=&quot;insert_for_order_1.xml&quot; /&gt;
       &lt;assertion parameters=&quot;2:int, 2:int, insert:String&quot; expected-data-file=&quot;insert_for_order_2.xml&quot; /&gt;
    &lt;/dml-test-case&gt;
&lt;/integrate-test-cases&gt;
</code></pre>

<p>another kind of config for assert is the data, as known as the corresponding expected-data-file in SQL-TYPE-integrate-test-cases.xml, which is at <code>/incubator-shardingsphere/sharding-integration-test/sharding-jdbc-test/src/test/resources/integrate/cases/SQL-TYPE/dataset/SHARDING-TYPE/*.xml</code><br />
this file is very like the dataset.xml we mentioned before, and the difference is that expected-data-file contains some other assert data, such as the return value after a sql execution, the examples as following :</p>

<pre><code class="language-xml">&lt;dataset update-count=&quot;1&quot;&gt;
    &lt;metadata data-nodes=&quot;db_${0..9}.t_order&quot;&gt;
        &lt;column name=&quot;order_id&quot; type=&quot;numeric&quot; /&gt;
        &lt;column name=&quot;user_id&quot; type=&quot;numeric&quot; /&gt;
        &lt;column name=&quot;status&quot; type=&quot;varchar&quot; /&gt;
    &lt;/metadata&gt;
    &lt;row data-node=&quot;db_0.t_order&quot; values=&quot;1000, 10, update&quot; /&gt;
    &lt;row data-node=&quot;db_0.t_order&quot; values=&quot;1001, 10, init&quot; /&gt;
    &lt;row data-node=&quot;db_0.t_order&quot; values=&quot;2000, 20, init&quot; /&gt;
    &lt;row data-node=&quot;db_0.t_order&quot; values=&quot;2001, 20, init&quot; /&gt;
&lt;/dataset&gt;
</code></pre>

<p>so far, all config files are ready, we just need to launch the corresponding test case. we don&rsquo;t need to modify any Java code, just set up some config files.
this will reduce the difficulty for ShardingSphere testing</p>

<h2 id="notice">Notice</h2>

<ol>
<li>If Oracle needs to be tested, please add Oracle driver dependencies to the pom.xml.</li>
<li>10 splitting-databases and 10 splitting-tables are used in the integrated test to ensure the test data is full, so it will take a relatively long time to run the test cases.</li>
</ol>

<h1 id="sql-parsing-engine-test">SQL Parsing Engine Test</h1>

<h2 id="prepare-data">Prepare Data</h2>

<p>not like Integration test, SQL parse test doesn&rsquo;t need a specific database environment, we just need to define the sql we want to parse, and the assert data :</p>

<h3 id="sql-data">SQL Data</h3>

<p>we mentioned sql-case-id in Integration test，test-case-id could be shared in different module to test, and the file is at <code>/incubator-shardingsphere/sharding-sql-test/src/main/resources/sql/sharding/SQL-TYPE/*.xml</code></p>

<h3 id="parser-assert-data">Parser Assert Data</h3>

<p>the assert data is at <code>/incubator-shardingsphere/sharding-core/sharding-core-parse/sharding-core-parse-test/src/test/resources/sharding/SQL-TYPE/*.xml</code>
in that xml file, we could assert against the table name, token or sql condition and so on. for example :</p>

<pre><code class="language-xml">&lt;parser-result-sets&gt;
&lt;parser-result sql-case-id=&quot;insert_with_multiple_values&quot;&gt;
        &lt;tables&gt;
            &lt;table name=&quot;t_order&quot; /&gt;
        &lt;/tables&gt;
        &lt;tokens&gt;
            &lt;table-token start-index=&quot;12&quot; table-name=&quot;t_order&quot; length=&quot;7&quot; /&gt;
        &lt;/tokens&gt;
        &lt;sharding-conditions&gt;
            &lt;and-condition&gt;
                &lt;condition column-name=&quot;order_id&quot; table-name=&quot;t_order&quot; operator=&quot;EQUAL&quot;&gt;
                    &lt;value literal=&quot;1&quot; type=&quot;int&quot; /&gt;
                &lt;/condition&gt;
                &lt;condition column-name=&quot;user_id&quot; table-name=&quot;t_order&quot; operator=&quot;EQUAL&quot;&gt;
                    &lt;value literal=&quot;1&quot; type=&quot;int&quot; /&gt;
                &lt;/condition&gt;
            &lt;/and-condition&gt;
            &lt;and-condition&gt;
                &lt;condition column-name=&quot;order_id&quot; table-name=&quot;t_order&quot; operator=&quot;EQUAL&quot;&gt;
                    &lt;value literal=&quot;2&quot; type=&quot;int&quot; /&gt;
                &lt;/condition&gt;
                &lt;condition column-name=&quot;user_id&quot; table-name=&quot;t_order&quot; operator=&quot;EQUAL&quot;&gt;
                    &lt;value literal=&quot;2&quot; type=&quot;int&quot; /&gt;
                &lt;/condition&gt;
            &lt;/and-condition&gt;
        &lt;/sharding-conditions&gt;
    &lt;/parser-result&gt;
&lt;/parser-result-sets&gt;
</code></pre>

<p>when these configs are ready, we could launch the test engine in sharding-core-parse-test to test SQL parse</p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="https://shardingsphere.apache.org/community/en/contribute/external-dependency/" title="External dependencies"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="https://shardingsphere.apache.org/community/en/company/" title="Powered By ShardingSphere" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://shardingsphere.apache.org/community/js/clipboard.min.js?1572453612"></script>
    <script src="https://shardingsphere.apache.org/community/js/perfect-scrollbar.min.js?1572453612"></script>
    <script src="https://shardingsphere.apache.org/community/js/perfect-scrollbar.jquery.min.js?1572453612"></script>
    <script src="https://shardingsphere.apache.org/community/js/jquery.sticky.js?1572453612"></script>
    <script src="https://shardingsphere.apache.org/community/js/featherlight.min.js?1572453612"></script>
    <script src="https://shardingsphere.apache.org/community/js/html5shiv-printshiv.min.js?1572453612"></script>
    <script src="https://shardingsphere.apache.org/community/js/highlight.pack.js?1572453612"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://shardingsphere.apache.org/community/js/modernizr.custom.71422.js?1572453612"></script>
    <script src="https://shardingsphere.apache.org/community/js/learn.js?1572453612"></script>
    <script src="https://shardingsphere.apache.org/community/js/hugo-learn.js?1572453612"></script>

    <link href="https://shardingsphere.apache.org/community/mermaid/mermaid.css?1572453612" type="text/css" rel="stylesheet" />
    <script src="https://shardingsphere.apache.org/community/mermaid/mermaid.js?1572453612"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

